[tools]
deno = "2"
rust = "stable"

[tasks.setup]
description = "Install JS dependencies using deno.lock"
run = "deno install --frozen"

[tasks.dev]
description = "Start Tauri in development mode"
run = "env -u RUSTUP_TOOLCHAIN PATH=\"/opt/homebrew/bin:$PATH\" deno task tauri dev --config src-tauri/tauri.ci-development.conf.json"

[tasks.dev_signed]
description = "Build and launch a signed debug macOS app bundle (for App Service-dependent features like ShazamKit)"
run = """
env -u RUSTUP_TOOLCHAIN PATH="/opt/homebrew/bin:$PATH" deno task dev:signed
"""

[tasks.dev_signed_lldb]
description = "Build signed debug bundle and run inside lldb"
run = """
env -u RUSTUP_TOOLCHAIN PATH="/opt/homebrew/bin:$PATH" deno task dev:signed:lldb
"""

[tasks.test]
description = "Run frontend unit tests"
run = "deno task test"

[tasks.build]
description = "Build frontend and Tauri app without bundling"
run = "env -u RUSTUP_TOOLCHAIN PATH=\"/opt/homebrew/bin:$PATH\" deno task tauri build --no-bundle --config src-tauri/tauri.ci-development.conf.json"

[tasks.bundle]
description = "Build distributable Tauri bundles"
run = "env -u RUSTUP_TOOLCHAIN PATH=\"/opt/homebrew/bin:$PATH\" deno task tauri build --config src-tauri/tauri.ci-development.conf.json"

[tasks.bundle_ci_development]
description = "Build bundle using CI development provisioning profile overlay"
run = "env -u RUSTUP_TOOLCHAIN PATH=\"/opt/homebrew/bin:$PATH\" deno task bundle:ci:development"

[tasks.bundle_ci_distribution]
description = "Build bundle using CI distribution provisioning profile overlay"
run = "env -u RUSTUP_TOOLCHAIN PATH=\"/opt/homebrew/bin:$PATH\" deno task bundle:ci:distribution"

[tasks.doctor]
description = "Print toolchain versions and Tauri diagnostics"
run = """
deno --version
rustc --version
cargo --version
deno task tauri info
"""
